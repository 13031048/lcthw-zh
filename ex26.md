# 练习26：编写第一个真正的程序

> 原文：[Exercise 26: Write A First Real Program](http://c.learncodethehardway.org/book/ex26.html)

> 译者：[飞龙](https://github.com/wizardforcel)

这本书你已经完成一半了，所以你需要做一个其中检测。期中检测中你需要重新构建一个我特地为本书编写的软件，叫做`devpkg`。随后你需要以一些方式扩展它，并且通过编写一些单元测试来改进代码。

> 注

> 我在一些你需要完成的练习之前编写了这个练习。如果你现在尝试这个练习，记住软件可能会含有一些bug，你可能由于我的错误会产生一些问题，你也可能不知道需要什么来完成它。如果这样的话，通过[help@learncodethehardway.org](mailto:help@learncodethehardway.org)来告诉我，之后等待我写完其它练习。

## 什么是`devpkg`？

`devpkg`是一个简单的C程序，可以用于安装其它软件。我特地为本书编写了它，作为一种方式来教你真正的软件是如何构建的，以及如何复用他人的库。它使用了一个叫做[Apache可移植运行时（APR）](http://apr.apache.org/)的库，其中含有许多工作跨平台的便利的C函数，包括Windows。此外，它只是从互联网（或本地文件）抓取代码，并且执行通常的`./configure ; make ; make install`命令，每个程序员都用到过。

这个练习中，你的目标是从源码构建`devpkg`，完成我提供的每个挑战，并且使用源码来理解`devpkg`做了什么和为什么这样做。

## 我们打算创建什么

我们打算创建一个具有三个命令的工具：

devpkg -S

在电脑上安装新的软件。

devpkg -I

从URL安装软件。

devpkg -L

列出安装的所有软件。

devpkg -F

为手动构建抓取源代码。

devpkg -B

构建所抓取的源码代码并且安装它，即使它已经安装了。

我们想让`devpkg`能够接受几乎任何URL，判断项目的类型，下载，安装，以及注册已经安装的软件。我们也希望它能够处理一个简单的依赖列表，以便它能够安装项目所需的所有软件。

## 设计

为了完成这一目标，`devpkg`具有非常简单的设计：

使用外部命令

大多数工作都是通过类似于`curl`、`git`和`tar`的外部命令完成的。这样减少了`devpkg`所需的代码量。

简单的文件数据库

你可以轻易使它变得很复杂，但是一开始你需要完成一个简单的文件数据库，位于`/usr/local/.devpkg/db`，来跟踪已安装的软件。

`/usr/local`

同样你可以使它更高级，但是对于初学者来说，假设项目始终位于`/usr/local`中，它是爱多数Unix软件的标准安装目录。

`configure; make; make install`

假设大多数软件可以通过`configure; make; make install`来安装，也许`configure`是可选的。如果软件不能通过这种方式安装，要么提供某种方式来修改命令，要么`devpkg`就可以无视它。

用户可以root

我们假设用于可以使用`sudo`来提升至root权限，除非他们直到最后才想root。

这会使我们的程序像当初设想的一样简单，并且对于它的功能来说已经足够了。之后你可以进一步修改它。

